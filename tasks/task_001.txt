# Task ID: 1
# Title: Thiết lập cấu trúc dự án và cơ sở dữ liệu
# Status: pending
# Dependencies: None
# Priority: high
# Description: Công việc này bao gồm việc khởi tạo và định hình nền tảng cho toàn bộ dự án FastAPI, đồng thời thiết lập và cấu hình cơ sở dữ liệu PostgreSQL để lưu trữ dữ liệu ứng dụng. Đây là bước nền tảng quan trọng cho tất cả các tính năng sau này.
# Details:
1.  **Thiết lập cấu trúc thư mục cho dự án FastAPI**: Tạo một cây thư mục logic và dễ quản lý cho mã nguồn, bao gồm các module chính, routers, models, schemas, services, và các thư mục phụ trợ khác (ví dụ: `app/`, `app/api/v1/`, `app/core/`, `app/db/`, `app/models/`, `app/schemas/`, `app/services/`, `app/utils/`, `tests/`, `scripts/`, `alembic/`).
2.  **Cấu hình môi trường phát triển và các tệp cấu hình**: Tạo và quản lý các biến môi trường (ví dụ: thông tin kết nối cơ sở dữ liệu, secret keys, API keys bên ngoài) cho các môi trường khác nhau (development, testing, production) sử dụng tệp `.env`. Thiết lập tệp cấu hình trung tâm (ví dụ: `app/core/config.py`) để load các biến này một cách an toàn.
3.  **Thiết lập kết nối đến PostgreSQL**: Cài đặt driver PostgreSQL cho Python (ví dụ: `asyncpg` cho FastAPI). Viết mã trong `app/db/session.py` để thiết lập và quản lý pool kết nối đến PostgreSQL sử dụng SQLAlchemy (Core hoặc ORM). Đảm bảo kết nối an toàn, có khả năng retry cơ bản và được quản lý vòng đời đúng cách trong request.
4.  **Thiết kế và tạo các bảng dữ liệu ban đầu (sẽ được mở rộng ở các task sau)**:
    * **Người dùng (users)**: `id` (UUID, PK), `email` (VARCHAR, UNIQUE, NOT NULL), `hashed_password` (VARCHAR, NOT NULL), `full_name` (VARCHAR), `is_active` (BOOLEAN, default TRUE), `is_superuser` (BOOLEAN, default FALSE), `created_at` (TIMESTAMPZ, default NOW()), `updated_at` (TIMESTAMPZ, default NOW()).
    * **Tài khoản mạng xã hội (social_accounts)**: Sẽ được chi tiết hóa ở Task 3.
    * **Bảng quản lý bài đăng (posts_management)**: Sẽ được chi tiết hóa ở Task 5.
    * **Lịch đăng bài (schedules)**: Sẽ được chi tiết hóa ở Task 6, liên kết với `posts_management`.
    * **Media (media_assets)**: `id` (UUID, PK), `user_id` (FK đến users), `file_name` (VARCHAR), `file_type` (VARCHAR, ví dụ: 'image/jpeg', 'video/mp4'), `storage_path` (VARCHAR, đường dẫn trên cloud storage), `uploaded_at` (TIMESTAMPZ, default NOW()). (Sẽ được tích hợp sâu hơn ở Task 4)
5.  **Triển khai các hàm truy vấn cơ sở dữ liệu cơ bản (CRUD helpers)**: Tạo các hàm generic hoặc specific trong `app/crud/` để thực hiện các thao tác cơ bản (Create, Read, Update, Delete) với các model SQLAlchemy. Ví dụ: `app/crud/crud_user.py`.
6.  **Viết script migration cho cơ sở dữ liệu**: Sử dụng Alembic để quản lý schema migrations. Tạo migration ban đầu cho các bảng đã thiết kế ở bước 4.

# Test Strategy:
1.  Kiểm tra kết nối thành công đến cơ sở dữ liệu PostgreSQL từ ứng dụng FastAPI.
2.  Kiểm tra các hàm CRUD cơ bản cho bảng `users` hoạt động chính xác (tạo, đọc, cập nhật, xóa người dùng).
3.  Xác minh Alembic migration chạy đúng và tạo ra schema cơ sở dữ liệu như mong đợi.

# Subtasks:
## 1. Tạo cấu trúc thư mục dự án FastAPI [done]
### Dependencies: None
### Description: Thiết lập cấu trúc thư mục ban đầu, có tổ chức cho dự án.
### Details:
Tạo các thư mục chính như `app` (chứa mã nguồn ứng dụng), `app/api/v1` (cho các API endpoints phiên bản 1), `app/core` (cấu hình, middleware), `app/db` (thiết lập DB, session), `app/models` (SQLAlchemy models), `app/schemas` (Pydantic schemas), `app/services` (logic nghiệp vụ), `app/crud` (hàm truy vấn DB), `tests` (unit, integration tests), `alembic` (cho migrations).

## 2. Khởi tạo cấu hình môi trường [done]
### Dependencies: 1.1
### Description: Thiết lập các tệp cấu hình và biến môi trường.
### Details:
Tạo tệp `.env.example` với các biến cần thiết (DB_HOST, DB_USER, DB_PASS, DB_NAME, SECRET_KEY, OPENAI_API_KEY). Tạo lớp `Settings` trong `app/core/config.py` sử dụng Pydantic để load các biến này từ môi trường. Đảm bảo `.env` được thêm vào `.gitignore`.

## 3. Cài đặt và cấu hình cơ sở dữ liệu PostgreSQL [done]
### Dependencies: 1.1
### Description: Cài đặt PostgreSQL (nếu phát triển local) và cấu hình kết nối từ FastAPI.
### Details:
Đảm bảo PostgreSQL server đang chạy. Cài đặt `asyncpg` và `SQLAlchemy`. Viết mã trong `app/db/session.py` để tạo `engine` và `SessionLocal` cho SQLAlchemy. Cung cấp hàm dependency `get_db` để sử dụng trong API routes.

## 4. Thiết kế lược đồ cơ sở dữ liệu ban đầu [done]
### Dependencies: 1.3
### Description: Thiết kế các bảng ban đầu dựa trên yêu cầu.
### Details:
Định nghĩa SQLAlchemy models cho `User` và `MediaAsset` trong thư mục `app/models/`. Bao gồm các trường cơ bản, kiểu dữ liệu, ràng buộc, và quan hệ (nếu có ở giai đoạn này).

## 5. Viết script migration cơ sở dữ liệu ban đầu với Alembic [done]
### Dependencies: 1.4
### Description: Khởi tạo Alembic và tạo migration đầu tiên cho các bảng đã thiết kế.
### Details:
Chạy `alembic init alembic`. Cấu hình `env.py` để Alembic nhận diện được các models SQLAlchemy. Tạo revision đầu tiên với `alembic revision -m "create_initial_tables"` và định nghĩa việc tạo bảng `users`, `media_assets` trong script migration.

## 6. Chạy migration cơ sở dữ liệu ban đầu [done]
### Dependencies: 1.5
### Description: Thực thi script migration để tạo các bảng trong cơ sở dữ liệu.
### Details:
Chạy lệnh `alembic upgrade head` để áp dụng migration vào cơ sở dữ liệu. Kiểm tra trong DB xem các bảng đã được tạo đúng cấu trúc chưa.

